// Generated by CoffeeScript 1.12.7
var HttpUtils, getHeader, param, request, resultFunction;

resultFunction = function(callback, error, response, body) {
  if (!error && response.statusCode === 200) {
    callback({
      success: true,
      msg: body
    });
    //console.log('request is success ');
  } else {
    console.log('request is error', error);
    callback({
      success: false,
      msg: error
    });
  }
};

getHeader = function() {
  return {
    'Content-type': 'application/json; charset=UTF-8',
    //'Accept': 'application/json; charset=UTF-8'
  };
};

'use strict';

HttpUtils = exports;

request = require('request');
var http = require('http');

HttpUtils.eventUrl = {
    cwmp_event : 'http://127.0.0.1:7577/api/v1/cwmp-event',
    devNew:       'http://127.0.0.1:7577/api/v1/cwmp-event/devNew',
    inform:       'http://127.0.0.1:7577/api/v1/cwmp-event/inform',
    rpcResponse:  'http://127.0.0.1:7577/api/v1/cwmp-event/rpcResponse',
    transferComplete:   'http://127.0.0.1:7577/api/v1/cwmp-event/transferComplete',
    doloadResponse  :   'http://127.0.0.1:7577/api/v1/cwmp-event/doloadResponse',
    wifiProbe:    'http://127.0.0.1:7577/api/v1/cwmp-event/wifiProbe'
};

HttpUtils.postForm = function(url, form, callback) {
  var header, option;
  header = getHeader();
  option = {
    json: true,
    header: header,
    body: form
  };
  request.post(url, option, function(error, response, body) {
    resultFunction(callback, error, response, body);
  });
};

HttpUtils.postFormJson = function(url, form, callback) {
  var header, option;
  header = getHeader();
  option = {
    url: url,
    method: 'POST',
    json: true,
    headers: header,
    body: form
  };
  request(option, function(error, response, body) {
    resultFunction(callback, error, response, body);
  });
};

param = {
  user: 'username',
  pass: 'password'
};

// HttpUtils.postForm(HttpUtils.eventUrl.cwmp_event, param, function(result) {
//   console.log(result);
// });
//
// HttpUtils.postFormJson(HttpUtils.eventUrl.cwmp_event, param, function(result) {
//   console.log(result);
// });


HttpUtils.postFormJson1 = function(url, form, callback)
{
    var options = {
        host: '127.0.0.1',
        port: 7577,
        path: (url.match(/\/api.*/))[0],
        method: 'post',
        headers:{
            'Content-Type':'application/json',
            'Content-Length': JSON.stringify(form).length
        }};

    console.log(options);
    console.log('options: ' + JSON.stringify(options));

//使用http 发送
    var req = http.request(options, function(res) {
        //console.log('STATUS: ' + res.statusCode);
        //console.log('HEADERS: ' + JSON.stringify(res.headers));

        res.setEncoding('utf8');
        var _data="";

        res.on('data', function (chunk) {
            _data+=chunk;
            console.log('BODY: ' + chunk);
        });

        res.on('end', function(){
            if(res.statusCode === 200){
                callback({
                    success: true,
                    msg: _data
                });
            }else {
                callback({
                    success: false,
                    msg: "res.statusCode is not 200"
                });
            }

        });

        req.on('error', function(e) {
            console.log('problem with request: ' + e.message);
            callback({
                success: false,
                msg: e.message
            });
        });
    });

    req.write(JSON.stringify(form) + "\n");
    req.end();
};



